<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Galaxy Network</title>
    <style>
        /* Reset стилей */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Основные стили */
        body {
            background: #000;
            overflow: hidden;
            touch-action: none;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui;
            height: 100vh;
        }

        /* Холст для звёзд */
        #galaxy {
            width: 100%;
            height: 100%;
        }

        /* Модальное окно (iOS-стиль) */
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(40px);
            border-radius: 18px;
            padding: 20px;
            color: #fff;
            width: 85%;
            max-width: 300px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        /* Прогресс-бар */
        .progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, #f0f0ff 0%, #fff0ff 100%);
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Кнопка закрытия */
        .close {
            position: absolute;
            right: 16px;
            top: 16px;
            font-size: 24px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .close:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <canvas id="galaxy"></canvas>
    
    <div id="starModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="starUsername" style="font-size: 1.2em; margin-bottom: 8px;">@username</h2>
            <p style="opacity: 0.8;">Уровень: <span id="starLevel">1</span></p>
            <div class="progress-bar">
                <div class="progress" id="starProgress" style="width: 30%;"></div>
            </div>
        </div>
    </div>

    <script>
        // Инициализация
        const canvas = document.getElementById('galaxy');
        const ctx = canvas.getContext('2d');
        let stars = [];
        let currentUser = null;

        // Размеры холста
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        // Генерация звезды
        function generateStar(userId) {
            const newStar = {
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                radius: 6,
                color: '#ffffff',
                userId: userId,
                level: 1
            };

            // Проверка коллизий
            const minDistance = 70;
            const hasCollision = stars.some(star => {
                const dx = star.x - newStar.x;
                const dy = star.y - newStar.y;
                return Math.sqrt(dx*dx + dy*dy) < minDistance;
            });

            if (!hasCollision) {
                stars.push(newStar);
                saveStars();
                return true;
            }
            return false;
        }

        // Анимация
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            stars.forEach(star => {
                // Мерцание
                const glow = Math.random() * 0.4 + 0.6;
                
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${glow})`;
                ctx.shadowColor = star.color;
                ctx.shadowBlur = 15;
                ctx.fill();
            });
            
            requestAnimationFrame(animate);
        }

        // Обработка кликов
        function handleClick(e) {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;

            stars.forEach(star => {
                const dx = x - star.x;
                const dy = y - star.y;
                if (Math.sqrt(dx*dx + dy*dy) < 20) {
                    showStarModal(star);
                }
            });
        }

        // Модальное окно
        function showStarModal(star) {
            const modal = document.getElementById('starModal');
            document.getElementById('starUsername').textContent = `@user_${star.userId}`;
            document.getElementById('starLevel').textContent = star.level;
            document.getElementById('starProgress').style.width = `${(star.level % 100)}%`;
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('starModal').style.display = 'none';
        }

        // LocalStorage
        function saveStars() {
            localStorage.setItem('galaxyStars', JSON.stringify(stars));
        }

        function loadStars() {
            const saved = localStorage.getItem('galaxyStars');
            stars = saved ? JSON.parse(saved) : [];
        }

        // Инициализация
        window.addEventListener('load', () => {
            resizeCanvas();
            loadStars();
            
            // Создаём первую звезду для нового пользователя
            if (stars.length === 0) {
                generateStar(Date.now().toString(36));
            }
            
            animate();
        });

        // События
        window.addEventListener('resize', resizeCanvas);
        canvas.addEventListener('click', handleClick);
        canvas.addEventListener('touchstart', handleClick);
    </script>
</body>
</html>
